<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KAP TPE ‚Äì DCVisuals</title>
  <meta name="description" content="Profitez de l'aide Kap TPE pour financer jusqu'√† 60‚ÄØ% de votre projet de communication num√©rique √† La R√©union : vid√©o, site vitrine, visite virtuelle, photo professionnelle avec DCVisuals." />
  <style>
    html {
      scroll-behavior: smooth;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #001f3f, #2e3b4e);
      color: #fff;
    }
    header, section {
      padding: 2rem 1rem;
      max-width: 1100px;
      margin: auto;
    }
    h1, h2, h3 {
      color: #FFD700;
    }
    .hero {
      background-color: #2f2f2f;
      text-align: center;
      padding: 4rem 2rem;
    }
    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    .hero p {
      font-size: 1.2rem;
      color: #ccc;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    .card {
      background: #2f2f2f;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 2px 10px rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 4px 20px rgba(255,255,255,0.2);
    }
    a.cta-button {
      display: inline-block;
      margin-top: 2rem;
      padding: 1rem 2rem;
      background: #FFD700;
      color: #000;
      border-radius: 8px;
      font-weight: bold;
      text-decoration: none;
      transition: background 0.3s;
    }
    a.cta-button:hover {
      background: #FFC300;
    }
    .example-button {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: #FFD700;
      color: #000;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    .example-button:hover {
      background: #FFC300;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.8);
    }
    .modal-content {
      background-color: #2f2f2f;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 800px;
      color: white;
      border-radius: 12px;
      text-align: center;
    }
    .modal-content iframe, .modal-content img {
      width: 100%;
      max-width: 100%;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .close {
      color: #FFD700;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: #fff;
      text-decoration: none;
    }
    .grid-section-2x2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      max-width: 1100px;
      margin: auto;
    }
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2rem;
      }
      .grid-section-2x2 {
        grid-template-columns: 1fr;
      }
      header, section {
        padding: 1.5rem 1rem;
      }
    }
    label {
      display: block;
      margin: 0.75rem 0 0.25rem;
      font-weight: bold;
    }
    input[type="checkbox"] {
      margin-right: 0.5rem;
    }
    .card-block label {
      margin: 0.3rem 0;
      font-weight: normal;
    }
  </style>

<style>
  .simulateur-kap {
  max-width: 650px;
  background-color: #002b5c;
  color: #ffffff;
  border-radius: 10px;
  padding: 2rem;
  margin: 2rem auto;
  font-family: Arial, sans-serif;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.simulateur-kap h2 {
  color: #FFD700;
  font-size: 1.75rem;
}

.simulateur-kap p {
  color: #ccc;
  font-size: 1rem;
}

.simulateur-kap label {
  margin-top: 1rem;
  display: block;
  font-weight: bold;
  color: #FFD700;
}

.simulateur-kap input,
.simulateur-kap select {
  width: 100%;
  padding: 0.75rem;
  margin-top: 0.25rem;
  border-radius: 5px;
  border: none;
  font-size: 1rem;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
  background-color: #f0f0f0;
  color: #000;
}

.simulateur-kap button {
  margin-top: 2rem;
  background-color: #FFD700;
  color: #000;
  font-weight: bold;
  font-size: 1rem;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s;
}

.simulateur-kap button:hover {
  background-color: #e6c200;
}

.simulateur-kap #result {
  margin-top: 2rem;
  background-color: #1e1e1e;
  border-left: 5px solid #FFD700;
  padding: 1rem;
  border-radius: 8px;
  color: #fff;
}

.simulateur-kap .contact-buttons {
  margin-top: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.simulateur-kap .contact-buttons a {
  display: inline-block;
  padding: 0.75rem;
  background-color: #00e676;
  color: #000;
  font-weight: bold;
  text-align: center;
  border-radius: 6px;
  text-decoration: none;
}

</style>

<style>
  .card-block {
    padding: 1.5rem;
    margin-top: 2rem;
    border-radius: 12px;
    background-color: #002B5C;
  }
  .card-block:nth-of-type(odd) {
    background-color: #003a73;
  }
  .card-block:nth-of-type(even) {
    background-color: #002f5c;
  }

  .checkbox-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background-color: rgba(255, 255, 255, 0.05);
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    transition: background 0.3s;
  }

  .checkbox-group label:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  details {
    background-color: rgba(255,255,255,0.05);
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
  }

  details summary {
    cursor: pointer;
    font-weight: bold;
    color: #FFD700;
  }

  textarea,
  input[type="text"],
  input[type="number"],
  input[type="url"],
  select {
    background-color: #001f3f;
    border: 1px solid #FFD700;
    border-radius: 6px;
    padding: 0.5rem;
    color: #fff;
    width: 100%;
    margin-top: 0.25rem;
  }

  textarea:focus,
  input:focus,
  select:focus {
    outline: none;
    border-color: #FFC300;
    background-color: #002b5c;
  }
</style>

<style>
  .simulateur-budget {
    max-width: 650px;
    margin: 2rem auto;
    background-color: #002b5c;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    color: #fff;
    font-family: Arial, sans-serif;
  }

  .simulateur-budget h2 {
    color: #FFD700;
    font-size: 1.75rem;
    margin-bottom: 1rem;
  }

  .simulateur-budget label {
    color: #FFD700;
    font-weight: bold;
    margin: 1rem 0 0.25rem;
    display: block;
  }

  .simulateur-budget input[type="number"],
  .simulateur-budget input[type="text"],
  .simulateur-budget select,
  .simulateur-budget textarea {
    width: 100%;
    padding: 0.75rem;
    margin-top: 0.25rem;
    border-radius: 6px;
    border: none;
    font-size: 1rem;
    background-color: #f0f0f0;
    color: #000;
  }

  .simulateur-budget details {
    background-color: #003a73;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
  }

  .simulateur-budget summary {
    cursor: pointer;
    font-weight: bold;
    font-size: 1.1rem;
    color: #FFD700;
  }

  .simulateur-budget button {
    margin-top: 2rem;
    padding: 0.75rem 1.5rem;
    background-color: #FFD700;
    color: #000;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s ease;
  }

  .simulateur-budget button:hover {
    background-color: #e6c200;
  }

  .simulateur-budget .card-block {
    background-color: #003a73;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
  }
</style>

</head>
<body>
  <header class="hero">
    <h1>Aide Kap TPE pour artisans et commer√ßants √† La R√©union</h1>
    <p>Et si vous deveniez l‚Äôacteur principal de votre propre entreprise&nbsp;?</p>
    <p>Acc√©dez √† une subvention allant jusqu‚Äô√† 60‚ÄØ% pour valoriser votre image, votre savoir-faire et votre pr√©sence en ligne avec l‚Äôaide KAP TPE et DCVisuals.</p>
  </header>

<section class="benefits">
  <h2>üöÄ Ce que cette aide peut changer pour vous</h2>
  <div class="grid-section-2x2">
    <div class="card">
      <h3>üé• Exprimez votre voix</h3>
      <p>Cr√©ez une vid√©o qui raconte votre histoire, montre vos valeurs et attire la confiance.</p>
      <button class="example-button" onclick="openModal('modalVideo')">üé• Voir un exemple</button>
    </div>
    <div class="card">
      <h3>üåê Devenez visible en ligne</h3>
      <p>Un site internet moderne et bien r√©f√©renc√© qui travaille pour vous 24h/24.</p>
      <button class="example-button" onclick="openModal('modalSite')">üåê Voir un exemple</button>
    </div>
    <div class="card">
      <h3>üì∑ Inspirez la confiance</h3>
      <p>Des photos professionnelles qui subliment votre espace ou vos r√©alisations.</p>
      <button class="example-button" onclick="openModal('modalPhoto')">üì∑ Voir un exemple</button>
    </div>
    <div class="card">
      <h3>üè™ Offrez une visite √† distance</h3>
      <p>Avec une visite virtuelle, vos clients d√©couvrent votre lieu sans se d√©placer.</p>
      <button class="example-button" onclick="openModal('modalVisite')">üè™ Voir un exemple</button>
    </div>
  </div>
</section>

<!-- Modals -->
<div id="modalVideo" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('modalVideo')">&times;</span>
    <h3>D√©couvrez un exemple de production vid√©o</h3>
    <iframe src="https://www.youtube.com/embed/2pKziRg1XUs" frameborder="0" allowfullscreen style="width: 100%; height: 315px; border-radius: 8px;"></iframe>
    <a href="https://www.dcvisuals.fr/prestations/videaste-professionnel" class="cta-button" target="_blank">Voir toutes nos vid√©os</a>
  </div>
</div>

<div id="modalSite" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('modalSite')">&times;</span>
    <h3>D√©couvrez des exemples de sites web</h3>
    <img src="https://dcvisuals.github.io/dcvisuals-portfolio/photo5.png" alt="Exemple site web" style="width: 100%; max-height: 400px; object-fit: cover; border-radius: 8px;">
    <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-top: 1rem;">
      <a href="https://villapanoramagrandeanse.re/" class="cta-button" target="_blank">Site n¬∞ 1</a>
      <a href="https://villaidylle.re/" class="cta-button" target="_blank">Site n¬∞ 2</a>
      <a href="https://www.villaspagrandanse.re/" class="cta-button" target="_blank">Site n¬∞ 3</a>
      <a href="https://www.lappartdanslesnuages.re/" class="cta-button" target="_blank">Site n¬∞ 4</a>
    </div>
  </div>
</div>

<div id="modalPhoto" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('modalPhoto')">&times;</span>
    <h3>D√©couvrez des exemples de photos professionnelles</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px;">
      <img src="https://dcvisuals.github.io/dcvisuals-portfolio/photo1.jpg" style="width: 100%; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 4px;">
      <img src="https://dcvisuals.github.io/dcvisuals-portfolio/photo2.jpg" style="width: 100%; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 4px;">
      <img src="https://dcvisuals.github.io/dcvisuals-portfolio/photo3.jpg" style="width: 100%; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 4px;">
      <img src="https://dcvisuals.github.io/dcvisuals-portfolio/photo4.jpg" style="width: 100%; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 4px;">
    </div>
    <a href="https://www.dcvisuals.fr/portfolio" class="cta-button" target="_blank">Voir le portfolio</a>
  </div>
</div>

<div id="modalVisite" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('modalVisite')">&times;</span>
    <h3>D√©couvrez un exemple de visite virtuelle</h3>
    <iframe src="https://my.matterport.com/show/?m=K5jbgZbGz8S" frameborder="0" allowfullscreen style="width: 100%; height: 400px; border-radius: 8px;"></iframe>
    <a href="https://www.dcvisuals.fr/prestations/visite-virtuelle-360-et-3d" class="cta-button" target="_blank">Voir toutes nos visites</a>
  </div>
</div>




  <section class="goals">
    <h2>üéØ Objectifs marketing concrets</h2>
    <ul>
      <li>üîç √ätre mieux r√©f√©renc√© sur Google</li>
      <li>üìà Augmenter votre visibilit√© locale</li>
      <li>üí¨ D√©velopper vos √©changes et fid√©liser</li>
      <li>üí° D√©marquer votre marque des concurrents</li>
    </ul>
  </section>

  <section class="steps">
    <h2>üõ†Ô∏è Comment √ßa se passe ?</h2>
    <div class="grid">
      <div class="card"><h3>1. D√©finir vos objectifs</h3><p>Nous √©changeons sur votre activit√© et vos envies.</p></div>
      <div class="card"><h3>2. Construire le projet</h3><p>Nous vous proposons une solution √©ligible et impactante.</p></div>
      <div class="card"><h3>3. R√©aliser vos contenus</h3><p>Nous r√©alisons vid√©o, site, visite virtuelle, photos‚Ä¶</p></div>
      <div class="card"><h3>4. Accompagnement au dossier</h3><p>Nous vous aidons √† d√©poser votre demande Kap TPE.</p></div>
    </div>
  </section>


<!-- Simulateur Montant Projet avanc√© -->
<section class="simulateur-budget" style="background-color: #002B5C; padding: 2rem; border-radius: 12px; color: #fff;">

  <h2>üí∏ Estimez le montant de votre projet</h2>
  <form id="estimationForm">
    <div class="card-block">
      <label style="font-weight: bold; margin-bottom: .5rem; display: block;">Choisissez votre ou vos objectifs :</label>
      <div class="checkbox-group" style="display: flex; flex-direction: column; gap: .75rem;">
        <label>
          <input type="checkbox" name="objectif" value="photo" onchange="genererDetailsProjet(this)"> üì∑ Reportage photo professionnel
        </label>
        <div id="bloc-photo"></div>

        <label>
          <input type="checkbox" name="objectif" value="video" onchange="genererDetailsProjet(this)"> üé• Vid√©o de pr√©sentation ou promotion
        </label>
        <div id="bloc-video"></div>

        <label>
          <input type="checkbox" name="objectif" value="site" onchange="genererDetailsProjet(this)"> üåê Cr√©ation de site web
        </label>
        <div id="bloc-site"></div>

        <label>
          <input type="checkbox" name="objectif" value="visite" onchange="genererDetailsProjet(this)"> üè† Visite virtuelle immersive
        </label>
        <div id="bloc-visite"></div>
      </div>
    </div>

    <button type="button" onclick="calculBudgetTotal()" class="cta-yellow" style="margin-top: 2rem; background-color: #FFD700; color: #000; font-weight: bold; padding: 0.75rem 1.5rem; border: none; border-radius: 6px; cursor: pointer;">Calculer le budget estim√©</button>
  </form>
  <div id="resultatEstimation"></div>
</section>

<script>
function genererDetailsProjet(input) {
  const id = `bloc-${input.value}`;
  const blocParent = document.getElementById(id);
  blocParent.innerHTML = "";

  if (!input.checked) return;

  let bloc = document.createElement("div");
  bloc.className = "card-block";
  bloc.style = "background-color: #003a73; padding: 1rem; margin-top: 1rem; border-radius: 8px;";

  switch (input.value) {



case "photo":
  bloc.innerHTML = `
    <p style="margin-bottom:1rem;">S√©lectionnez un ou plusieurs formats de prise de vue :</p>

    <details>
      <summary><strong>üì∏ Prises de vue classiques</strong></summary>
      <label>Choisissez un pack :</label>
      <select id="photoPackSelect" data-type="photo-pack">
        <option value="525">10 √† 15 photos</option>
        <option value="875">15 √† 30 photos</option>
        <option value="1575">30 √† 50 photos</option>
        <option value="0">Personnalis√© (35‚Ç¨/photo, minimum 5)</option>
      </select>

      <div class="custom-photo-wrapper" style="display:none; margin-top: .5rem;">
        <input type="number" id="photoCustomInput" placeholder="Nombre de photos (min. 5)" data-libre="photo" min="5">
        <small id="photoErrorMsg" style="color: #FFD700; display: none;">‚ö†Ô∏è Minimum 5 photos</small>
      </div>

      <div class="checkbox-group" style="margin-top:1rem;">
        <label><input type="checkbox" data-option="drone-photo"> Prise de vue drone</label>
      </div>
    </details>

    <details style="margin-top:1.5rem;">
      <summary><strong>üõ∞Ô∏è Photogramm√©trie (mod√©lisation 3D)</strong></summary>
      <label>Surface √† couvrir (en m¬≤) :</label>
      <input type="number" min="10" step="10" data-type="photo-3d-surface" placeholder="Ex : 1500">

      <label style="margin-top:0.75rem;">Niveau de d√©tail souhait√© (px/cm) :</label>
      <input type="text" data-type="photo-3d-detail" placeholder="Ex : 1.2 px/cm">

      <div class="checkbox-group" style="margin-top:1rem;">
        <label><input type="checkbox" data-option="ortho"> Livraison Orthophoto</label>
        <label><input type="checkbox" data-option="modele3d"> Livraison mod√®le 3D</label>
      </div>
    </details>

    <details style="margin-top:1.5rem;">
      <summary><strong>üîß Prises de vue non retouch√©es</strong></summary>
      <label>Nombre de photos sans retouche :</label>
      <input type="number" min="1" data-type="photo-brut" placeholder="Ex : 20">
    </details>

    <div style="margin-top:1.5rem;">
      <h4>‚úèÔ∏è Informations compl√©mentaires</h4>
      <label>Pr√©cisions ou contexte :</label>
      <textarea data-type="photo-commentaire" placeholder="Ex : lieu(x) du/des shooting(s), usage des photos (limite de cession de droit souhait√©), d√©lai de livraison urgent..." style="width:100%; height: 80px;"></textarea>
    </div>
  `;

  setTimeout(() => {
    const select = document.getElementById("photoPackSelect");
    const wrapper = document.querySelector(".custom-photo-wrapper");
    const input = document.getElementById("photoCustomInput");

    if (!select || !wrapper || !input) return;

    select.addEventListener("change", () => {
      if (select.value === "0") {
        wrapper.style.display = "block";
        input.required = true;
      } else {
        wrapper.style.display = "none";
        input.required = false;
        input.value = "";
      }
    });

    // Afficher si d√©j√† s√©lectionn√©
    if (select.value === "0") {
      wrapper.style.display = "block";
      input.required = true;
    }
  }, 50);

  break;






case "video":
  bloc.innerHTML = `
    <h4>üé¨ S√©lectionnez les types de vid√©os souhait√©s :</h4>

    <details style="margin-bottom:1rem;">
      <summary><strong>üìå Vid√©o institutionnelle</strong></summary>
      <div style="margin-top:0.5rem;">
        <label>Quantit√© :</label>
        <input type="number" min="0" data-type="video-institutionnelle-quantite" placeholder="Ex : 1">
        <label>Dur√©e (en minutes) :</label>
        <input type="number" min="0" data-type="video-institutionnelle-duree" placeholder="Ex : 3">
      </div>
    </details>

    <details style="margin-bottom:1rem;">
      <summary><strong>üì± Vid√©o format court (r√©seaux sociaux)</strong></summary>
      <div style="margin-top:0.5rem;">
        <label>Quantit√© :</label>
        <input type="number" min="0" data-type="video-short-quantite" placeholder="Ex : 5">
        <label>Dur√©e (en secondes) :</label>
        <input type="number" min="0" data-type="video-short-duree" placeholder="Ex : 30">
      </div>
    </details>

    <details style="margin-bottom:1rem;">
      <summary><strong>üéì Vid√©o longue (formations, conf√©rences...)</strong></summary>
      <div style="margin-top:0.5rem;">
        <label>Quantit√© :</label>
        <input type="number" min="0" data-type="video-longue-quantite" placeholder="Ex : 1">
        <label>Dur√©e (en minutes) :</label>
        <input type="number" min="0" data-type="video-longue-duree" placeholder="Ex : 30">
      </div>
    </details>

    <h4 style="margin-top:1rem;">‚öôÔ∏è Options compl√©mentaires</h4>
    <div class="checkbox-group" style="margin-top:0.5rem;">
      <label><input type="checkbox" data-option="drone"> Prise de vue drone</label>
      <label><input type="checkbox" data-option="voix"> Voix-off</label>
      <label><input type="checkbox" data-option="interview"> Interview</label>
      <label><input type="checkbox" data-option="multi"> Multi cam√©ra</label>
      <label><input type="checkbox" data-option="sous-titres"> Sous-titres</label>
      <label><input type="checkbox" data-option="habillage"> Habillage / Branding</label>
    </div>

    <h4 style="margin-top:1.5rem;">‚úèÔ∏è Informations compl√©mentaires</h4>
    <label>Pr√©cisions ou objectifs :</label>
    <textarea data-type="video-commentaire" placeholder="Ex : lieu de tournage, th√®me abord√©, messages √† faire v√©hiculer..." style="width:100%; height: 80px;"></textarea>

    <label style="margin-top:0.75rem; display:block;">Lien vers une vid√©o inspirante (facultatif) :</label>
    <input type="url" data-type="video-inspiration" placeholder="https://...">
  `;
  break;





            case "site":
  bloc.innerHTML = `
    <label>Quel type de site souhaitez-vous ?</label>
    <select data-type="site">
      <option value="1200">Site vitrine</option>
      <option value="1600">Site marchand</option>
      <option value="1800">Site de r√©servation</option>
    </select>

    <label style="margin-top:1rem; display:block;">Nombre de pages √† pr√©voir :</label>
    <input type="number" data-type="site-pages" min="1" placeholder="Ex : 5 pages (accueil, contact, etc.)">

    <label style="margin-top:1rem; display:block;">Fonctionnalit√©s souhait√©es :</label>
    <div class="checkbox-group">
      <label><input type="checkbox" data-option="formulaire"> Formulaire de contact / r√©servation</label>
      <label><input type="checkbox" data-option="galerie"> Galerie photo/vid√©o</label>
      <label><input type="checkbox" data-option="maps"> Int√©gration Google Maps</label>
      <label><input type="checkbox" data-option="newsletter"> Newsletter / Emailing</label>
      <label><input type="checkbox" data-option="reseaux"> Connexion r√©seaux sociaux</label>
      <label><input type="checkbox" data-option="multilingue"> Multilingue</label>
      <label><input type="checkbox" data-option="blog"> Blog / Actualit√©s</label>
      <label><input type="checkbox" data-option="calendrier"> Int√©gration calendrier / RDV</label>
    </div>

    <label style="margin-top:1rem; display:block;">Souhaitez-vous une aide sur le contenu ?</label>
    <select data-type="contenu">
      <option value="fournis">Je fournis mes textes / visuels</option>
      <option value="a_creer">Je veux que vous r√©digiez et int√©griez mes contenus</option>
    </select>

    <label style="margin-top:1rem; display:block;">Souhaitez-vous un accompagnement ?</label>
    <div class="checkbox-group">
      <label><input type="checkbox" data-option="formation"> Formation √† la gestion du site</label>
      <label><input type="checkbox" data-option="maintenance"> Maintenance / mises √† jour</label>
    </div>

    <label style="margin-top:1rem; display:block;">Souhaitez-vous une identit√© visuelle ?</label>
    <div class="checkbox-group">
      <label><input type="checkbox" data-option="logo"> Cr√©ation de logo</label>
      <label><input type="checkbox" data-option="charte"> Cr√©ation de design personnalis√© / charte graphique</label>
    </div>

<div style="margin-top:1.5rem;">
  <h4>‚úèÔ∏è Informations compl√©mentaires</h4>
  <label>Pr√©cisions ou besoin sp√©cifique :</label>
  <textarea data-type="site-commentaire" placeholder="Ex : structure du site, style souhait√©, inspirations..." style="width:100%; height: 80px;"></textarea>
</div>

  `;
  break;



case "visite":
  bloc.innerHTML = `
    <label>Surface habitable (en m¬≤) :</label>
    <input type="number" data-type="visite" min="10" placeholder="Ex : 180">

    <label style="margin-top:1rem; display:block;">Surface ext√©rieure √† scanner (en m¬≤) :</label>
    <input type="number" data-type="visite-exterieur" min="0" placeholder="Ex : 50">
    <small style="color:#ccc; display:block; margin-top:0.25rem;">
      ‚ö†Ô∏è N‚Äôindiquez que les espaces r√©ellement √† scanner : terrasse, piscine, cuisine ext√©rieure, d√©pendances. Ne pas inscrire la totalit√© du terrain.
    </small>

    <small style="color:#ccc; display:block; margin-top:0.75rem;">
      üí° Abonnement Matterport offert pendant 2 ans.<br>
      D√®s la 3·µâ ann√©e : 40‚ÄØ‚Ç¨/an par tranche de 200‚ÄØm¬≤.
    </small>

    <label style="margin-top:1rem; display:block;">√âl√©ments ext√©rieurs √† int√©grer :</label>
    <div class="checkbox-group">
      <label><input type="checkbox" data-option="piscine"> Piscine</label>
      <label><input type="checkbox" data-option="terrasse"> Terrasse</label>
      <label><input type="checkbox" data-option="jardin"> Jardin</label>
    </div>

    <label style="margin-top:0.75rem; display:block;">Autres √©l√©ments √† mod√©liser (optionnel) :</label>
    <input type="text" data-type="autres-exterieurs" placeholder="Cuisine ext√©rieure, d√©pendance, garage, etc.">

    <label style="margin-top:1rem; display:block;">Options d‚Äôexport :</label>
    <div class="checkbox-group">
      <label><input type="checkbox" data-option="plan"> Plan de niveau</label>
      <label><input type="checkbox" data-option="nuage"> Nuage de points 3D</label>
    </div>

<div style="margin-top:1.5rem;">
  <h4>‚úèÔ∏è Informations compl√©mentaires</h4>
  <label>Pr√©cisions ou √©l√©ments particuliers :</label>
  <textarea data-type="visite-commentaire" placeholder="Ex : acc√®s difficile, sur plusieurs niveau, lieu du shooting, d√©lai de livraison urgent..." style="width:100%; height: 80px;"></textarea>
</div>

  `;
  break;

  }

  blocParent.appendChild(bloc);
}

function calculBudgetTotal() {
  let total = 0;





// Traitement des photos
document.querySelectorAll("div#bloc-photo").forEach(photoBloc => {
  let blocTotal = 0;

  // üì∏ Section classique
  const classique = photoBloc.querySelector("details:nth-of-type(1)");
  if (classique && classique.open) {
    const selectPack = photoBloc.querySelector("select[data-type='photo-pack']");
    if (selectPack) {
      const val = parseInt(selectPack.value);
      if (val === 0) {
        const nbPhotos = parseInt(photoBloc.querySelector("input[data-libre='photo']")?.value || "0");
        if (nbPhotos >= 5) blocTotal += nbPhotos * 35;
      } else {
        blocTotal += val;
      }
    }

    if (photoBloc.querySelector("input[data-option='drone-photo']")?.checked) {
      blocTotal += 300;
    }
  }

  // üõ∞Ô∏è Section photogramm√©trie
  const photogrammetrie = photoBloc.querySelector("details:nth-of-type(2)");
  if (photogrammetrie && photogrammetrie.open) {
    const surfaceM2 = parseFloat(photoBloc.querySelector("input[data-type='photo-3d-surface']")?.value || "0");
    if (surfaceM2 > 0) {
      const tranches = Math.ceil(surfaceM2 / 20000); // par 2 hectares = 20000 m¬≤
      blocTotal += tranches * 300;
    }

    if (photoBloc.querySelector("input[data-option='modele3d']")?.checked) {
      blocTotal += 150;
    }
  }

  // üîß Section photo brute
  const brut = photoBloc.querySelector("details:nth-of-type(3)");
  if (brut && brut.open) {
    const nbBrut = parseInt(photoBloc.querySelector("input[data-type='photo-brut']")?.value || "0");
    if (nbBrut > 0) {
      blocTotal += nbBrut * 20;
    }
  }

  total += blocTotal;
});





// Traitement des vid√©os
function getVal(name) {
  return parseFloat(document.querySelector(`input[data-type='${name}']`)?.value || "0");
}

const instQty = getVal("video-institutionnelle-quantite");
const instDur = getVal("video-institutionnelle-duree");
const shortQty = getVal("video-short-quantite");
const shortDur = getVal("video-short-duree");
const longQty = getVal("video-longue-quantite");
const longDur = getVal("video-longue-duree");

let sousTotalVideo = 0;
sousTotalVideo += instQty * instDur * 250; // Institutionnelle : 250 ‚Ç¨/min
sousTotalVideo += shortQty * (shortDur / 60) * 300; // Short : 300 ‚Ç¨/min
sousTotalVideo += longQty * longDur * 150; // Longue : 150 ‚Ç¨/min

const totalQty = instQty + shortQty + longQty;
if (totalQty >= 5) sousTotalVideo *= 0.9;

const optionPrix = {
  "drone": 400,
  "voix": 150,
  "interview": 100,
  "multi": 500,
  "sous-titres": 100,
  "habillage": 200
};

Object.entries(optionPrix).forEach(([opt, prix]) => {
  if (document.querySelector(`input[data-option='${opt}']`)?.checked) {
    sousTotalVideo += prix * totalQty;
  }
});

total += Math.round(sousTotalVideo);




// Traitement sp√©cifique pour le site web
document.querySelectorAll("div#bloc-site").forEach(siteBloc => {
  const typeSite = siteBloc.querySelector("select[data-type='site']");
  const nbPages = parseInt(siteBloc.querySelector("input[data-type='site-pages']")?.value || "0");
  const contenu = siteBloc.querySelector("select[data-type='contenu']")?.value;

  if (!typeSite) return;

  let tarifBase = parseInt(typeSite.value); // 1200, 1600, 1800
  let majPages = 0;
  let majContenu = 0;

  if (!isNaN(nbPages) && nbPages > 0) {
    if (nbPages <= 5) majPages = 200;
    else if (nbPages <= 10) majPages = 400;
    else if (nbPages <= 15) majPages = 600;
    else majPages = 600 + ((nbPages - 15) * 50);
  }

if (contenu === "a_creer") {
  if (nbPages > 0) {
    majContenu = nbPages * 100;
  } else {
    majContenu = 300; // forfait minimum si aucune page renseign√©e
  }
}

  total += tarifBase + majPages + majContenu;

  // Options avec montants cach√©s
  const options = [
    { selector: "input[data-option='formulaire']", price: 150 },
    { selector: "input[data-option='galerie']", price: 150 },
    { selector: "input[data-option='maps']", price: 100 },
    { selector: "input[data-option='newsletter']", price: 200 },
    { selector: "input[data-option='reseaux']", price: 100 },
    { selector: "input[data-option='multilingue']", price: 250 },
    { selector: "input[data-option='blog']", price: 200 },
    { selector: "input[data-option='calendrier']", price: 250 },
    { selector: "input[data-option='formation']", price: 300 },
    { selector: "input[data-option='maintenance']", price: 400 },
    { selector: "input[data-option='logo']", price: 250 },
    { selector: "input[data-option='charte']", price: 500 },
  ];

  options.forEach(opt => {
    const el = siteBloc.querySelector(opt.selector);
    if (el?.checked) total += opt.price;
  });
});



// Traitement sp√©cifique pour la visite virtuelle
document.querySelectorAll("div#bloc-visite").forEach(visiteBloc => {
  const habitableInput = visiteBloc.querySelector("input[data-type='visite']");
  const exterieurInput = visiteBloc.querySelector("input[data-type='visite-exterieur']");

  if (!habitableInput || !exterieurInput) return;

  const habitable = parseFloat(habitableInput.value) || 0;
  const exterieur = parseFloat(exterieurInput.value) || 0;
  const surfaceTotale = habitable + exterieur;

  if (surfaceTotale === 0) return;

  // Base : 1,5 ‚Ç¨/m¬≤
  total += surfaceTotale * 1.5;

  // Abonnement 2 ans inclus ‚Üí 80 ‚Ç¨ par tranche de 200 m¬≤
  const tranches = Math.ceil(surfaceTotale / 200);
  total += tranches * 80;

  // Nuage de points ‚Üí 100 ‚Ç¨ par tranche de 200 m¬≤
  const nuage = visiteBloc.querySelector("input[data-option='nuage']");
  if (nuage?.checked) total += tranches * 100;

  // Plan de niveau ‚Üí 50 ‚Ç¨ forfaitaire
  const plan = visiteBloc.querySelector("input[data-option='plan']");
  if (plan?.checked) total += 50;
});

function collecterInfosPrestation() {
  const infos = [];

  // üì∏ Reportage photo professionnel
  const sectionPhoto = document.querySelector('[data-section="üì∏ Reportage photo professionnel"]');
  if (sectionPhoto) {
    infos.push("üì∏ Reportage photo professionnel");

    const pack = sectionPhoto.querySelector('select[name="pack-photo"]');
    if (pack && pack.value) infos.push(`üì¶ Pack : ${pack.value}`);

    const drone = sectionPhoto.querySelector('input[name="drone-photo"]');
    if (drone && drone.checked) infos.push("üöÅ Prise de vue drone");

    const surface = sectionPhoto.querySelector('input[name="surface-photo"]');
    if (surface && surface.value) infos.push(`üìê Surface √† mod√©liser : ${surface.value} m¬≤`);

    const detail = sectionPhoto.querySelector('input[name="niveau-detail"]');
    if (detail && detail.value) infos.push(`üìä D√©tail : ${detail.value}`);

    const ortho = sectionPhoto.querySelector('input[name="orthophoto"]');
    if (ortho && ortho.checked) infos.push("üñºÔ∏è Orthophoto");

    const modele = sectionPhoto.querySelector('input[name="modele-3d"]');
    if (modele && modele.checked) infos.push("üì¶ Mod√®le 3D");

    const brutes = sectionPhoto.querySelector('input[name="photos-brutes"]');
    if (brutes && brutes.value) infos.push(`üì∑ Photos non retouch√©es : ${brutes.value}`);

    const commentaire = sectionPhoto.querySelector('textarea[name="commentaire-photo"]');
    if (commentaire && commentaire.value.trim()) infos.push(`üìù Commentaire : ${commentaire.value.trim()}`);
  }

// üé• Vid√©o de pr√©sentation ou promotion
  const sectionVideo = document.querySelector('[data-section="üé• Vid√©o de pr√©sentation ou promotion"]');
  if (sectionVideo) {
    infos.push("üé• Vid√©o de pr√©sentation ou promotion");

    const type = sectionVideo.querySelector('select[name="type-video"]');
    if (type && type.value) infos.push(`üé¨ Type : ${type.value}`);

    const quantite = sectionVideo.querySelector('input[name="quantite-video"]');
    if (quantite && quantite.value) infos.push(`üéûÔ∏è Quantit√© : ${quantite.value}`);

    sectionVideo.querySelectorAll('input[name="video-options"]:checked').forEach(opt => {
      infos.push(`‚öôÔ∏è Option : ${opt.value}`);
    });

    const commentaire = sectionVideo.querySelector('textarea[name="commentaire-video"]');
    if (commentaire && commentaire.value.trim()) infos.push(`üìù Commentaire : ${commentaire.value.trim()}`);
  }

 // üåê Cr√©ation de site web
  const sectionSite = document.querySelector('[data-section="üåê Cr√©ation de site internet"]');
  if (sectionSite) {
    infos.push("üåê Cr√©ation de site internet");

    const type = sectionSite.querySelector('select[name="type-site"]');
    if (type && type.value) infos.push(`üåç Type de site : ${type.value}`);

    sectionSite.querySelectorAll('input[name="site-options"]:checked').forEach(opt => {
      infos.push(`üß© Fonctionnalit√© : ${opt.value}`);
    });

    sectionSite.querySelectorAll('input[name="site-contenu"]:checked').forEach(opt => {
      infos.push(`üìù Contenu : ${opt.value}`);
    });

    sectionSite.querySelectorAll('input[name="site-identite"]:checked').forEach(opt => {
      infos.push(`üé® Identit√© visuelle : ${opt.value}`);
    });

    const commentaire = sectionSite.querySelector('textarea[name="commentaire-site"]');
    if (commentaire && commentaire.value.trim()) infos.push(`üìù Commentaire : ${commentaire.value.trim()}`);
  }

 // üåÄ Visite virtuelle immersive
  const sectionVirtuelle = document.querySelector('[data-section="üè† Visite virtuelle immersive"]');
  if (sectionVirtuelle) {
    infos.push("üè† Visite virtuelle immersive");

    const surfInt = sectionVirtuelle.querySelector('input[name="surface-int"]');
    if (surfInt && surfInt.value) infos.push(`üìè Int√©rieur : ${surfInt.value} m¬≤`);

    const surfExt = sectionVirtuelle.querySelector('input[name="surface-ext"]');
    if (surfExt && surfExt.value) infos.push(`üå≥ Ext√©rieur : ${surfExt.value} m¬≤`);

    sectionVirtuelle.querySelectorAll('input[name="virtuel-options"]:checked').forEach(opt => {
      infos.push(`üè° √âl√©ments ext√©rieurs : ${opt.value}`);
    });

    sectionVirtuelle.querySelectorAll('input[name="virtuel-export"]:checked').forEach(opt => {
      infos.push(`üì§ Export : ${opt.value}`);
    });

    const commentaire = sectionVirtuelle.querySelector('textarea[name="commentaire-visite"]');
    if (commentaire && commentaire.value.trim()) infos.push(`üìù Commentaire : ${commentaire.value.trim()}`);
  }

  return infos;
}



const remboursement = total * 0.5;
const montantChamp = document.getElementById("resultatEstimation");
montantChamp.innerHTML = `
  <div class="card-block" style="background-color: #003a73; color: #fff; border-radius: 8px; padding: 1rem; margin-top: 1.5rem;">
    <p>Total estim√© de votre projet : <strong>${total.toLocaleString()} ‚Ç¨</strong></p>
    <p>Montant de la subvention estim√©e (50%) : <strong>${remboursement.toLocaleString()} ‚Ç¨</strong></p>
    <p>üí° Pour √™tre √©ligible, votre projet doit √™tre compris entre 5 001 ‚Ç¨ et 19 999 ‚Ç¨ HT.</p>
    <button onclick="document.getElementById('montant').value = ${total}; document.getElementById('prestationsDetaillees').value = JSON.stringify(collecterInfosPrestation());" style="margin-top:1rem; background:#FFD700; color:#000; font-weight:bold; border:none; padding:0.75rem 1.5rem; border-radius:5px; cursor:pointer;">
üì• Renseigner ce montant dans le simulateur d‚Äô√©ligibilit√©
</button>
  </div>
`;
}

</script>
<section class="simulateur-kap">
  <h2 style="color: #FFD700;">üìä Simulateur d‚Äô√©ligibilit√© √† Kap TPE</h2>
  <p>üîç La liste des codes APE √©ligibles est consultable ici :
    <a href="https://data.artisanat.fr/nafa/" target="_blank" style="color: #FFD700; text-decoration: underline;">https://data.artisanat.fr/nafa/</a>
  </p>

  <label for="ape">Code APE :</label>
  <input type="text" id="ape" list="ape-list" placeholder="ex : 7420ZS" />
  <datalist id="ape-list"></datalist>

  <label for="ca">Chiffre d'affaires (en ‚Ç¨) - max : 1 000 000 ‚Ç¨</label>
  <input type="number" id="ca" placeholder="ex : 850000" />

  <label for="salaries">Nombre de salari√©s - max : 10</label>
  <input type="number" id="salaries" placeholder="ex : 3" />

  <label for="montant">Montant du projet (HT en ‚Ç¨) - entre 5‚ÄØ001‚ÄØ‚Ç¨ et 19‚ÄØ999‚ÄØ‚Ç¨ :</label>
  <input type="number" id="montant" placeholder="ex : 12000" />

  <label for="zone">√ätes-vous situ√© dans les Hauts de l'√Æle ?</label>
  <select id="zone">
    <option value="non">Non</option>
    <option value="oui">Oui</option>
  </select>

  <input type="hidden" id="prestationsDetaillees" />

  <button onclick="verifierEligibilite()">‚úÖ V√©rifier l'√©ligibilit√©</button>

<div id="result"></div>

<div id="contact-formulaire" style="margin-top: 2rem; display: none;">
  <h3>üì¨ Envoyez votre demande personnalis√©e</h3>
  <p>Merci de renseigner vos coordonn√©es pour recevoir une analyse compl√®te.</p>

  <label>Nom / Pr√©nom :</label>
  <input type="text" id="nom" placeholder="Jean Dupont" required>

  <label>Email :</label>
  <input type="email" id="email" placeholder="exemple@email.com" required>

  <label>T√©l√©phone (+262...)</label>
  <input type="tel" id="telephone" placeholder="+262..." required>


<div id="resume-prestations" style="background-color: #003a73; color: white; padding: 1rem; border-radius: 8px; margin-top: 2rem;">
  <h4>üìå Prestations s√©lectionn√©es :</h4>
  <ul id="liste-prestations" style="padding-left: 1rem;"></ul>
</div>

<!-- Champ invisible pour transmettre les prestations -->
<input type="hidden" id="prestationsDetaillees">


  <button onclick="envoyerVersAppsScript()" class="cta-yellow" style="margin-top: 1rem;">
    üì§ Envoyer la demande √† DCVisuals
  </button>

  <p id="confirmation-envoi" style="margin-top: 1rem; color: #FFD700;"></p>
</div>

</section>

</script>







  <section class="faq">
    <h2>‚ùì Questions fr√©quentes</h2>
    <details><summary>Qui peut b√©n√©ficier de Kap TPE ?</summary><p>Tout artisan ou restaurateur √† La R√©union, avec un projet num√©rique entre 5‚ÄØ001‚ÄØ‚Ç¨ et 19‚ÄØ999‚ÄØ‚Ç¨ HT.</p></details>
    <details><summary>Faut-il avancer les frais ?</summary><p>Oui, l‚Äôaide est vers√©e apr√®s validation du projet et de la facture. Nous vous aidons √† planifier cela.</p></details>
    <details><summary>Combien de temps pour obtenir la subvention ?</summary><p>Le traitement du dossier peut prendre 4 √† 8 semaines selon les p√©riodes.</p></details>
  </section>

  <section class="cta-final">
    <h2>üì© Envie de faire √©voluer votre entreprise ?</h2>
    <p>Nous vous accompagnons √† chaque √©tape. Ensemble, valorisons votre image.</p>
  </section>

  <script>
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('section').forEach(section => {
      section.classList.add('section');
      observer.observe(section);
    });
  </script>

  <script>
    function openModal(id) {
      document.getElementById(id).style.display = "block";
    }
    function closeModal(id) {
      document.getElementById(id).style.display = "none";
    }
    window.onclick = function(event) {
      document.querySelectorAll('.modal').forEach(modal => {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      });
    }
  </script>
<!-- üîΩ Ton script ici juste avant la fermeture -->
<script>
let codesAPEEligibles = []; // ‚Üê d√©claration globale ici

// üîß Fonction pour retrouver le libell√© √† partir du code APE
function getLibelleAPE(code) {
  const entry = codesAPEEligibles.find(e => e.code === code);
  return entry ? entry.label : "";
}

// üîß Fonction collecterInfosPrestation ici (celle que tu viens d‚Äôajouter)

function collecterInfosPrestation() {
  const infos = [];

  // üì∏ Reportage photo professionnel
  const sectionPhoto = document.querySelector('[data-section="üì∏ Reportage photo professionnel"]');
  if (sectionPhoto) {
    infos.push("üì∏ Reportage photo professionnel");

    const pack = sectionPhoto.querySelector('select[name="pack-photo"]');
    if (pack && pack.value) infos.push(`üì¶ Pack : ${pack.value}`);

    const drone = sectionPhoto.querySelector('input[name="drone-photo"]');
    if (drone && drone.checked) infos.push("üöÅ Prise de vue drone");

    const surface = sectionPhoto.querySelector('input[name="surface-photo"]');
    if (surface && surface.value) infos.push(`üìê Surface √† mod√©liser : ${surface.value} m¬≤`);

    const detail = sectionPhoto.querySelector('input[name="niveau-detail"]');
    if (detail && detail.value) infos.push(`üìä D√©tail : ${detail.value}`);

    const ortho = sectionPhoto.querySelector('input[name="orthophoto"]');
    if (ortho && ortho.checked) infos.push("üñºÔ∏è Orthophoto");

    const modele = sectionPhoto.querySelector('input[name="modele-3d"]');
    if (modele && modele.checked) infos.push("üì¶ Mod√®le 3D");

    const brutes = sectionPhoto.querySelector('input[name="photos-brutes"]');
    if (brutes && brutes.value) infos.push(`üì∑ Photos non retouch√©es : ${brutes.value}`);

    const commentaire = sectionPhoto.querySelector('textarea[name="commentaire-photo"]');
    if (commentaire && commentaire.value.trim()) infos.push(`üìù Commentaire : ${commentaire.value.trim()}`);
  }

// üé• Vid√©o de pr√©sentation ou promotion
  const sectionVideo = document.querySelector('[data-section="üé• Vid√©o de pr√©sentation ou promotion"]');
  if (sectionVideo) {
    infos.push("üé• Vid√©o de pr√©sentation ou promotion");

    const type = sectionVideo.querySelector('select[name="type-video"]');
    if (type && type.value) infos.push(`üé¨ Type : ${type.value}`);

    const quantite = sectionVideo.querySelector('input[name="quantite-video"]');
    if (quantite && quantite.value) infos.push(`üéûÔ∏è Quantit√© : ${quantite.value}`);

    sectionVideo.querySelectorAll('input[name="video-options"]:checked').forEach(opt => {
      infos.push(`‚öôÔ∏è Option : ${opt.value}`);
    });

    const commentaire = sectionVideo.querySelector('textarea[name="commentaire-video"]');
    if (commentaire && commentaire.value.trim()) infos.push(`üìù Commentaire : ${commentaire.value.trim()}`);
  }

 // üåê Cr√©ation de site web
  const sectionSite = document.querySelector('[data-section="üåê Cr√©ation de site internet"]');
  if (sectionSite) {
    infos.push("üåê Cr√©ation de site internet");

    const type = sectionSite.querySelector('select[name="type-site"]');
    if (type && type.value) infos.push(`üåç Type de site : ${type.value}`);

    sectionSite.querySelectorAll('input[name="site-options"]:checked').forEach(opt => {
      infos.push(`üß© Fonctionnalit√© : ${opt.value}`);
    });

    sectionSite.querySelectorAll('input[name="site-contenu"]:checked').forEach(opt => {
      infos.push(`üìù Contenu : ${opt.value}`);
    });

    sectionSite.querySelectorAll('input[name="site-identite"]:checked').forEach(opt => {
      infos.push(`üé® Identit√© visuelle : ${opt.value}`);
    });

    const commentaire = sectionSite.querySelector('textarea[name="commentaire-site"]');
    if (commentaire && commentaire.value.trim()) infos.push(`üìù Commentaire : ${commentaire.value.trim()}`);
  }

 // üåÄ Visite virtuelle immersive
  const sectionVirtuelle = document.querySelector('[data-section="üè† Visite virtuelle immersive"]');
  if (sectionVirtuelle) {
    infos.push("üè† Visite virtuelle immersive");

    const surfInt = sectionVirtuelle.querySelector('input[name="surface-int"]');
    if (surfInt && surfInt.value) infos.push(`üìè Int√©rieur : ${surfInt.value} m¬≤`);

    const surfExt = sectionVirtuelle.querySelector('input[name="surface-ext"]');
    if (surfExt && surfExt.value) infos.push(`üå≥ Ext√©rieur : ${surfExt.value} m¬≤`);

    sectionVirtuelle.querySelectorAll('input[name="virtuel-options"]:checked').forEach(opt => {
      infos.push(`üè° √âl√©ments ext√©rieurs : ${opt.value}`);
    });

    sectionVirtuelle.querySelectorAll('input[name="virtuel-export"]:checked').forEach(opt => {
      infos.push(`üì§ Export : ${opt.value}`);
    });

    const commentaire = sectionVirtuelle.querySelector('textarea[name="commentaire-visite"]');
    if (commentaire && commentaire.value.trim()) infos.push(`üìù Commentaire : ${commentaire.value.trim()}`);
  }

  return infos;
}

window.addEventListener('DOMContentLoaded', () => {
  let codesAPEEligibles = [];

  // Chargement des codes APE depuis le JSON
  fetch("https://dcvisuals.github.io/Simulateur-Kap-TPE-v2/codes-ape.json")
    .then(response => response.json())
    .then(data => {
      codesAPEEligibles = data.codes.map(entry => ({
        code: entry.code.toUpperCase(),
        label: entry.label
      }));
      const dataList = document.getElementById("ape-list");
      codesAPEEligibles.forEach(entry => {
        const option = document.createElement("option");
        option.value = entry.code;
        option.textContent = `${entry.code} - ${entry.label}`;
        dataList.appendChild(option);
      });
    });

  function getLibelleAPE(code) {
    const entry = codesAPEEligibles.find(e => e.code === code);
    return entry ? entry.label : "";
  }

  window.verifierEligibilite = function () {
    console.log("‚úÖ Fonction verifierEligibilite d√©clench√©e");

    const ape = document.getElementById("ape").value.toUpperCase().trim();
    const ca = parseInt(document.getElementById("ca").value);
    const salaries = parseInt(document.getElementById("salaries").value);
    const montant = parseInt(document.getElementById("montant").value);
    const zone = document.getElementById("zone").value;
    const result = document.getElementById("result");

    if (!ape || isNaN(ca) || isNaN(salaries) || isNaN(montant)) {
      result.innerHTML = "<strong>Erreur :</strong> Veuillez remplir tous les champs.";
      result.style.color = "#ff6b6b";
      document.getElementById("contact-formulaire").style.display = "none";
      return;
    }

    let errors = [];
    const codeAPEInfo = codesAPEEligibles.find(e => e.code === ape);

    if (!codeAPEInfo) errors.push("Votre code APE n‚Äôest pas √©ligible.");
    const plafond = ["4789ZP", "4776ZP"].includes(ape) ? 400000 : 1000000;
    if (ca > plafond) errors.push(`Chiffre d'affaires sup√©rieur au plafond de ${plafond.toLocaleString()} ‚Ç¨`);
    if (salaries > 10) errors.push("L'entreprise d√©passe le seuil de 10 salari√©s.");
    if (montant < 5001 || montant > 19999) errors.push("Le montant du projet doit √™tre entre 5‚ÄØ001‚ÄØ‚Ç¨ et 19‚ÄØ999‚ÄØ‚Ç¨ HT.");

    if (errors.length > 0) {
      result.innerHTML = "<strong>R√©sultat :</strong><br><ul><li>" + errors.join("</li><li>") + "</li></ul>";
      result.style.color = "#FFD700";
      document.getElementById("contact-formulaire").style.display = "none";
    } else {
      const taux = zone === "oui" ? 0.6 : 0.5;
      const aide = Math.round(montant * taux);
      const reste = montant - aide;

      const libelle = getLibelleAPE(ape);
      const corpsTexte = `Bonjour,

Mon code APE est le ${ape} (${libelle}),
Mon chiffre d'affaires est de ${ca} ‚Ç¨,
J'ai ${salaries} salari√©(s),
Le montant estim√© de mon projet est de ${montant} ‚Ç¨,
Je suis situ√© dans les ${zone === "oui" ? "Hauts" : "Bas"} de l'√Æle de la R√©union.

Merci de me confirmer les √©tapes √† suivre.

Cordialement,`;

      const corpsMail = encodeURIComponent(corpsTexte);

      result.innerHTML = `<strong>F√©licitations üéâ</strong><br>
        Votre projet semble √©ligible √† l‚Äôaide Kap TPE.<br>
        Taux : ${taux * 100}%<br>
        Aide estim√©e : ${aide.toLocaleString()} ‚Ç¨<br>
        Reste √† charge : ${reste.toLocaleString()} ‚Ç¨<br>

        <div class="contact-buttons" style="margin-top:1rem;">
          <a href="mailto:dolcecartolina.visuals@gmail.com?subject=Demande%20Kap%20TPE&body=${corpsMail}" style="display:inline-block; margin-right:1rem;">
            üìß Contactez-nous</a>
          <a href="tel:+262692200461">üìû Appelez-nous</a>
        </div>`;

      result.style.color = "#00e676";
     document.getElementById("contact-formulaire").style.display = "block";

      afficherResumePrestations();
    }
  }

  function afficherResumePrestations() {
    const prestations = collecterInfosPrestation(); // ‚Üê √† garder de ton script
    const liste = document.getElementById("liste-prestations");
    const hidden = document.getElementById("prestationsDetaillees");

    liste.innerHTML = "";
    prestations.forEach(p => {
      const li = document.createElement("li");
      li.textContent = p;
      liste.appendChild(li);
    });

    hidden.value = prestations.join(" / ");
  }

});

function envoyerVersAppsScript() {
  const nom = document.getElementById("nom").value.trim();
  const email = document.getElementById("email").value.trim();
  const telephone = document.getElementById("telephone").value.trim();
  const ape = document.getElementById("ape").value.toUpperCase().trim();
  const ca = parseInt(document.getElementById("ca").value.trim());
  const salaries = parseInt(document.getElementById("salaries").value.trim());
  const montant = parseInt(document.getElementById("montant").value.trim());
  const zone = document.getElementById("zone").value.trim();
  const libelleAPE = getLibelleAPE(ape);
  const prestations = collecterInfosPrestation();

  if (!nom || !email || !telephone || !ape || isNaN(ca) || isNaN(salaries) || isNaN(montant)) {
    alert("Merci de remplir tous les champs obligatoires.");
    return;
  }

  const payload = {
    nom,
    email,
    telephone,
    ape,
    libelleAPE,
    ca,
    salaries,
    montant,
    zone,
    prestations
  };

// üîç Pour debug : Affiche ce qu'on envoie
  console.log("Payload envoy√© :", payload);

  fetch("https://script.google.com/macros/s/AKfycbw7eY3fQrjlhXV_-SxhMKkKPOOyBnPXnFSWYgG_zn3BId4k4Evv-1tO8L8hRENU60P1/exec", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(payload)
  })
    .then(response => {
      if (!response.ok) throw new Error("Erreur serveur");
      return response.text();
    })
    .then(message => {
      document.getElementById("confirmation-envoi").innerHTML =
        "‚úÖ Votre demande a bien √©t√© envoy√©e. Merci, nous vous r√©pondrons rapidement.";
    })
    .catch(error => {
  document.getElementById("confirmation-envoi").innerHTML =
    "‚ùå Une erreur est survenue. Merci de r√©essayer plus tard.";
  console.error("Erreur lors de l'envoi :", error);
});
}
</script>
<!-- FIN du body -->


</body>
</html>
